# TODO

- [X] Create template for DOJO
- [X] Learn Project Structure
- [X] Add Schema.org
- [X] Add 404 page
- [X] Add site map page
- [ ] Add Components into `index.php`

---

# Структура проектов

Для изоляции изменяющихся файлов проекта от папки продукта используют директорию `/local`. Bitrix иногда выпускает новые модули или создает новые папки. Тогда приходится добавлять их в исключения. По сути, при использовании `/local` в исключения достаточно будет добавить одну директорию `/bitrix`. При обработке папок приоритет всегда у `/local` перед `/bitrix`.

Папки обрабатываемые в `/local`:

```
/local/activities        // действия из модуля бизнес-процессов
/local/components        // сторонние компоненты
/local/gadgets           // гаджеты для рабочего стола админки
/local/modules           // сторонние модули
/local/php_interface     // init.php, папка user_lang
/loca/templates          // шаблоны сайтов, компонентов, страниц
```

## Визуальные элементы сайта

| Шаблон               | Компонент             |
| -------------------- | --------------------- |
| Статические элементы | Динамические элементы |

> **Шаблон дизайна** -- это внешний вид сайта, в котором определяется расположение различных элементов на сайте, художественный стиль и способ отображения страниц.

> **Компонент** -- это логически завершённый код, предназначенный для извлечения информации из инфоблоков и других источников и преобразования её в HTML-код для отображения в виде фрагментов web-страниц.

Можно назначить свой собственный шаблон на каждый раздел сайта, на каждую страницу. И более того, выводить разные шаблоны для одной и той же страницы в зависимости от разных условий, например, для авторизованных пользователей один шаблон, для неавторизованных - другой.

```
Настройки
\_Настройки продукта
    \_Сайты
        \_Список сайтов
            \_Перейти к редактированию сайта
```

![](https://opt-560835.ssl.1c-bitrix-cdn.ru/images/admin_start/admin_base/control_elements/templates_11.png?149734135080981)

**Тип условия:**

| Название                | Применение шаблона                                            |
| ----------------------- | ------------------------------------------------------------- |
| Без условия             | К каждой странице сайта, к которой не указано другого условия |
| Для папки и файла       | К указанной папке (разделу) или файлу (странице)              |
| Для групп пользователей | Отображается только пользователям из указанных групп          |
| Период времени          | В указанный период времени                                    |
| Параметр в URL          | В адресе стоит определенный параметр                          |
| Выражение PHP           | В соответствии с заданным выражением PHP                      |

*Если для страницы (раздела) может быть применено несколько шаблонов, то в итоге будет применен шаблон с большей **сортировкой**.*

## Структура файлов шаблона:

```
/bitrix (local)/templates/ID шаблона сайта/

./header.php
./footer.php
./styles.css

./images/...             // Изображения
./components/...         // Шаблоны компонентов
./page_templates/...     // Шаблоны страниц
./include_areas/...      // Содержимое включаемых областей
./lang/...               // Языковые файлы
```

Для хранения библиотек и классов можно завести директорию `./lib`.

```
/local/lib/backend       // для php библиотек
/local/lib/frontend      // для js библиотек
```

Внутри файлов `header.php` и `footer.php` — не стоит размещать логику. Например в `header.php` определяется тип пользователя:

```php
<?php

    // Если хотите разместить блок с какой-то логикой,
    // то лучше набросайте компонент, это будет правильнее

    $GLOBALS["OPT_USER"] = false;
    if($USER->IsAuthorized()){
    	$uGroups = $USER->GetUserGroupArray();
    	if(in_array(11, $uGroups))
    		$GLOBALS["OPT_USER"] = true;
    }

?>
```

Внутри директории `./components` должны находиться кастомизированные шаблоны только **стандартных компонентов** или **компонентов сторонних разработчиков**. Не нужно кастомизировать шаблоны написанных вами компонентов! Если ты написал компонент, который правильно будет работать с конкретным шаблоном, то храни шаблон компонента внутри директории компонента.

## Структурное деление шаблона

Проанализируйте шаблон и определите, какая часть кода должна относится к Прологу (файл header.php), какая к Эпилогу (файл footer.php), а какая часть - к Рабочей области страницы.

![](https://dev.1c-bitrix.ru/images/content_manager/information/page_structure1.png)

Необходимо заменить некоторые части верстки:
 - Заменить подключение стилей и, возможно, javascript файлов на директиву `<?$APPLICATION->ShowHead()?>`
 - Заменить прописанный явно заголовок страницы на `<title><?$APPLICATION->ShowTitle()?></title>`
 - Сразу после тэга `<body>` добавить `<?$APPLICATION->ShowPanel();?>`
 - Перед всеми картинками добавить путь к ним `/local/templates/<? echo SITE_TEMPLATE_ID;?>/images/`
 - Заменить контент на специальный разделитель - `#WORK_AREA#`

В зависимости от того, где должен быть расположен компонент в файле header.php или footer.php, удаляется html код, отображающий данную функциональную область и вставляется код компонента.

![](https://opt-560835.ssl.1c-bitrix-cdn.ru/images/integration_course/templates/scheme2.png?1217336990122109)


## Физические страницы (Рабочая область)

Если в адресной строке браузера ввести следующий URL, то ответом будет результат работы скрипта `www/contacts/index.php`

```
http://ваше_доменное_имя/contacts/
```

Содержимое страниц должно иметь следующий вид:

```php
<?require($_SERVER["DOCUMENT_ROOT"]."/bitrix/header.php");?>
содержимое страницы
<?require($_SERVER["DOCUMENT_ROOT"]."/bitrix/footer.php");?>
```

По умолчанию в `.htaccess` файле указано что, если в структуре сайта запрашиваемый файл не найден - то возвращать `/404.php`

```
ErrorDocument 404 /404.php
```

Для добавления динамической информации необходимо вызвать компоненты в рабочей области.

## Вызова стандартных компонентов Bitrix

```php

// Добавление включаемой области
<?$APPLICATION->IncludeComponent(

    // имя компонента
    "bitrix:main.include",

    // шаблон компонента, /bitrix/templates/ID шаблона сайта/components/Шаблон компонента
    // пустая строка если шаблон по умолчанию
    "",

    // параметры
    Array(
        "AREA_FILE_SHOW" => "file",
        "PATH" => $APPLICATION->GetTemplatePath("include_areas/company_name.php"),
        "EDIT_TEMPLATE" => ""
    )
);?>

// include_areas/company_name.php
<?if(!defined("B_PROLOG_INCLUDED") || B_PROLOG_INCLUDED!==true)die();?>

World Book
  Все книги мира

// Подключение меню
<?$APPLICATION->IncludeComponent(
    "bitrix:menu",
    "horizontal_multilevel",
    Array(
        "ROOT_MENU_TYPE" => "top",
        "MAX_LEVEL" => "3",
        "CHILD_MENU_TYPE" => "left",
        "USE_EXT" => "Y",
        "MENU_CACHE_TYPE" => "A",
        "MENU_CACHE_TIME" => "3600",
        "MENU_CACHE_USE_GROUPS" => "Y",
        "MENU_CACHE_GET_VARS" => Array()
    )
);?>
```

## Создание шаблона компонента

Системные шаблоны поставляются вместе с компонентом и лежат в следующей директории:
```
/bitrix
    /components
        /namespace (bitrix)
            /название_компонента
                /templates
                    /название_шаблона
```

При копировании шаблона компонента средствами системы, они будут расположены по следующему пути:
```
/bitrix
    /templates
        /шаблон_сайта
            /components
                /namespace (bitrix)
                    /название_компонента
                        /название_шаблона
```

Пример вёрстки меню:

```html
<div class="topmenu">
        <ul class="topmenu">
            <li><a href="#" class="first">На главную</a></li>
            <li><a href="#">Новости</a></li>
            <li><a href="#" class="selected">Магазины</a></li>
            <li><a href="#">Книги</a></li>
            <li><a href="#">Форум</a></li>
            <li><a href="#">О компании</a></li>
            <li><a href="#">О Контакты</a></li>
        </ul>
</div>
```

Особенности вёрстки:
- У первого пункта меню должен быть указан стиль first;
- У выделенного пункта меню должен быть указан стиль selected;
- Меню является одноуровневым.

Стандартный шаблон компонента меню:

```php
// Проверка, вызван ли этот файл напрямую или нет. Если напрямую – прекратить работу.
<?if (!defined("B_PROLOG_INCLUDED") || B_PROLOG_INCLUDED!==true)die();?>

// Если массив с пунктами меню $arResult не пуст, то выполнять дальнейшие действия
<?if (!empty($arResult)):?>

    // Внешний блок и начало списка пунктов меню
    <div class="gray-tabs-menu">
        <ul>

            // Цикл по массиву с пунктами меню. В $arItem – текущий элемент цикла.
            <?foreach($arResult as $arItem):?>

                // Если текущий пользователь обладает правами на просмотр данной страницы,
                // вывести элемент списка с ссылкой на эту страницу.
                <?if ($arItem["PERMISSION"] > "D"):?>

                    // В полях LINK и TEXT содержится адрес страницы и название пункта меню
            	   <li><a href="<?=$arItem["LINK"]?>"><nobr><?=$arItem["TEXT"]?></nobr></a>
                <?endif?>

            <?endforeach?>

        </ul>
    </div>
    <div class="menu-clear-left"></div>
<?endif?>
```

Кастомный шаблон компонента меню для вёрстки:

```php
<?if (!defined("B_PROLOG_INCLUDED") || B_PROLOG_INCLUDED!==true)die();?>

<?if (!empty($arResult)):?>

    // Заменили стили у блока и у списка
    <div class="topmenu">
        <ul class="topmenu">

            // Ввели переменную $cnt
            <? $cnt=0; ?>
            <?foreach($arResult as $arItem):?>

                <?if ($arItem["PERMISSION"] > "D"):?>

                    // Условие проверки активного пункта меню
                    <?if ($arItem["SELECTED"]): ?>
                        <li>
                            <a href="<?=$arItem["LINK"]?>" class="selected">
                                <?=$arItem["TEXT"]?>
                            </a>
                        </li>
                    <?else:?>
                        // Условие проверки первого пункта меню
                        <?if ($cnt==0):?>
                            <li>
                                <a href="<?=$arItem["LINK"]?>" class="first">
                                    <?=$arItem["TEXT"]?>
                                </a>
                            </li>
                        <?else:?>
                            <li><a href="<?=$arItem["LINK"]?>"><?=$arItem["TEXT"]?></a></li>
                        <?endif?>    
                    <?endif?>

                    <?$cnt++; ?>
                <?endif?>
            <?endforeach?>

        </ul>
    </div>
<?endif?>
```

## Создание компонента

Внутри компонента можно создать файл `class.php`, который должен содержать класс, унаследованный от `CBitrixComponent`. Благодаря этому можно использовать наследование классов других компонентов при создании своих — иногда это очень полезный инструмент.

*to be continued...*
